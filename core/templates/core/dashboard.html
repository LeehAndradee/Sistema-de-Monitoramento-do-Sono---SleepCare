{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ titulo }}</title>
    
   <link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
</head>
<body class="dashboard-bg"> 
<div id="sleepcase-dashboard">
    
    <header id="navbar">
        <div class="logo">SleepCase</div>
        <nav>
            <a href="{% url 'dashboard' %}" style="font-weight: bold;">Dashboard</a>
            <a href="{% url 'registrar_sono' %}">Di√°rio de Sono</a>
            <a href="{% url 'dicas_higiene' %}">Metas & Desafios</a>
            <a href="{% url 'configuracoes' %}">Configura√ß√µes</a>
        </nav>
        <div class="user-profile">
            Ol√°, {{ user.get_username }} üåô
            <a href="{% url 'admin:logout' %}"><button id="logout">Sair</button></a>
        </div>
    </header>

    <main class="content-area">
        <h1>Bem-vindo, {{ user.first_name|default:user.username }}!</h1>
        <p class="status-message">Seu resumo e an√°lise de sono da √∫ltima semana.</p>

        <section class="data-grid summary-grid">
            
            <div class="card summary-card main-average">
                {% if metricas %}
                    <h3>üìä M√©dia Semanal de Sono</h3>
                    <p class="big-metric">{{ metricas.media_semanal }}h</p>
                    <p class="subtitle">Horas em m√©dia nos √∫ltimos 7 dias</p>
                {% else %}
                    <h3>üìä An√°lise Semanal</h3>
                    <p class="big-metric">--</p>
                    <p class="subtitle">Registre seu primeiro sono para ver as m√©tricas!</p>
                {% endif %}
            </div>

            <div class="card summary-card best-day">
                <h3>‚òÄÔ∏è Melhor Dia</h3>
                {% if metricas %}
                    <p class="medium-metric">{{ metricas.melhor_dia }}</p>
                    <p class="subtitle">Dia em que voc√™ dormiu mais</p>
                {% else %}
                    <p class="medium-metric">N/A</p>
                {% endif %}
            </div>

            <div class="card summary-card worst-day">
                <h3>üåô Pior Dia</h3>
                {% if metricas %}
                    <p class="medium-metric">{{ metricas.pior_dia }}</p>
                    <p class="subtitle">Dia em que voc√™ dormiu menos</p>
                {% else %}
                    <p class="medium-metric">N/A</p>
                {% endif %}
            </div>
            
        </section>
        
        <section class="data-grid full-width recent-logs">
            <h2>√öltimos Registros de Sono</h2>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Data que Dormiu</th>
                        <th>Horas Dormidas</th>
                        <th>Qualidade</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for registro in registros_recentes %}
                    <tr>
                        <td>{{ registro.data_dormiu|date:"d/m/Y H:i" }}</td>
                        <td>{{ registro.total_horas|floatformat:1 }}h</td>
                        <td>{{ registro.get_qualidade_sono_display }}</td>
                        <td><span class="alert-{{ registro.alerta_saude|lower|cut:' ' }}">{{ registro.alerta_saude }}</span></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="no-records-message">
                            Nenhum registro de sono encontrado. <a href="{% url 'registrar_sono' %}">Registre seu primeiro sono agora!</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        
    </main>
</div>
</body>
</html>