{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ titulo }}</title>

    <link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
</head>

<body class="dashboard-bg">
<div id="sleepcase-dashboard">

    <!-- NAVBAR -->
    <header id="navbar">
        <div class="logo">SleepCare</div>

        <nav class="nav-links">
            <a href="{% url 'dashboard' %}" class="active">Dashboard</a>
            <a href="{% url 'registrar_sono' %}">Di√°rio de Sono</a>
            <a href="{% url 'dicas_higiene' %}">Metas & Desafios</a>
        </nav>

        <div class="user-profile">
            <span class="username">
                Ol√°, {{ user.first_name|default:user.username }} üåô
            </span>
            <a href="{% url 'logout' %}" class="logout-btn">Sair</a>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="content-area">

        <h1 class="welcome-title">
            Bem-vindo, {{ user.first_name|default:user.username }}!
        </h1>
        <p class="status-message">
            Resumo dos seus registros de sono da √∫ltima semana.
        </p>

        <!-- M√âTRICAS RESUMO -->
        <section class="data-grid summary-grid">

            <!-- M√©dia semanal -->
            <div class="card summary-card main-average">
                {% if metricas %}
                    <h3>üìä M√©dia Semanal de Sono</h3>
                    <p class="big-metric">{{ metricas.media_semanal }}h</p>
                    <p class="subtitle">M√©dia de horas nos √∫ltimos 7 dias</p>
                {% else %}
                    <h3>üìä An√°lise Semanal</h3>
                    <p class="big-metric">--</p>
                    <p class="subtitle">
                        Registre seu primeiro sono para ver suas m√©tricas
                    </p>
                {% endif %}
            </div>

            <!-- Melhor dia -->
            <div class="card summary-card best-day">
                <h3>‚òÄÔ∏è Melhor Dia</h3>
                {% if metricas %}
                    <p class="medium-metric">{{ metricas.melhor_dia }}</p>
                    <p class="subtitle">Maior quantidade de horas dormidas</p>
                {% else %}
                    <p class="medium-metric">--</p>
                {% endif %}
            </div>

            <!-- Pior dia -->
            <div class="card summary-card worst-day">
                <h3>üåô Pior Dia</h3>
                {% if metricas %}
                    <p class="medium-metric">{{ metricas.pior_dia }}</p>
                    <p class="subtitle">Menor quantidade de horas dormidas</p>
                {% else %}
                    <p class="medium-metric">--</p>
                {% endif %}
            </div>

        </section>

        <!-- √öLTIMOS REGISTROS -->
        <section class="data-grid full-width recent-logs">

            <h2 class="section-title">√öltimos Registros de Sono</h2>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Data / Hora que Dormiu</th>
                        <th>Data / Hora que Acordou</th>
                        <th>Total Dormido</th>
                    </tr>
                </thead>

                <tbody>
                    {% for registro in registros_recentes %}
                    <tr>
                        <td>
                            {{ registro.data_dormiu|date:"d/m/Y" }}<br>
                            <small>{{ registro.data_dormiu|date:"H:i" }}</small>
                        </td>

                        <td>
                            {{ registro.data_acordou|date:"d/m/Y" }}<br>
                            <small>{{ registro.data_acordou|date:"H:i" }}</small>
                        </td>

                        <td>
                            {{ registro.total_horas_dormidas|floatformat:1 }}h
                        </td>
                    </tr>

                    {% empty %}
                    <tr>
                        <td colspan="3" class="no-records-message">
                            Nenhum registro encontrado.
                            <a href="{% url 'registrar_sono' %}">Registrar agora</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </section>

    </main>

</div>
</body>
</html>
